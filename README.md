# Raspberry Pi 5: Pi-hole DNS + v2rayA (TProxy) ‚Äî —Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ã–π VPN –ø–æ –¥–æ–º–µ–Ω–∞–º

> **–î–ª—è YouTube, Instagram –∏ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ —á–µ—Ä–µ–∑ VPN. –û—Å—Ç–∞–ª—å–Ω–æ–π —Ç—Ä–∞—Ñ–∏–∫ ‚Äî –Ω–∞–ø—Ä—è–º—É—é.**

–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π –ø—Ä–æ–∫—Å–∏ –ø–æ –¥–æ–º–µ–Ω–∞–º: –Ω–∞—Å—Ç—Ä–æ–π Raspberry Pi **–æ–¥–∏–Ω —Ä–∞–∑**, —Å–¥–µ–ª–∞–π –µ–≥–æ —à–ª—é–∑–æ–º (Gateway) –∏ DNS-—Å–µ—Ä–≤–µ—Ä–æ–º –≤ —Å–µ—Ç–∏ ‚Äî –∏ **–≤—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –±—É–¥—É—Ç —Ö–æ–¥–∏—Ç—å –Ω–∞ –Ω—É–∂–Ω—ã–µ —Å–∞–π—Ç—ã —á–µ—Ä–µ–∑ VPN, **–±–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** –Ω–∞ –∫–∞–∂–¥–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–µ/–∫–æ–º–ø—å—é—Ç–µ—Ä–µ.

---

## üì¶ –ß—Ç–æ –≤–Ω—É—Ç—Ä–∏

- **Pi-hole** (DNS + –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–∫–ª–∞–º—ã)
- **v2rayA** (—É–¥–æ–±–Ω–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VPN —Å transparent proxy)
- **dnsmasq + ipset** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–º–µ–Ω–æ–≤ –≤ —Å–ø–∏—Å–æ–∫ VPN)
- **iptables + TPROXY** (–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞)

---

## ‚ö° –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1) –ü–æ–¥–≥–æ—Ç–æ–≤—å Raspberry Pi

**–í–∞–∂–Ω–æ:** —Å—Ä–∞–∑—É –≤—ã–±–µ—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (Ethernet **–∏–ª–∏** Wi-Fi), –Ω–µ –º–µ–Ω—è–π –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Äî –∏–Ω–∞—á–µ IP/MAC –ø–æ–º–µ–Ω—è—é—Ç—Å—è –∏ —Å–µ—Ç—å ¬´–ø–æ–ø–ª—ã–≤—ë—Ç¬ª.

–ù–∞ Raspberry Pi:

```bash
sudo apt-get update && sudo apt-get install -y git
git clone https://github.com/Patkins93/rpi5-v2raya-transparent.git
cd rpi5-v2raya-transparent
```

–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–ø–∞—Ä–æ–ª—å –¥–ª—è Pi-hole): —Å–∫–æ–ø–∏—Ä—É–π `env.example` –≤ `.env` –∏ —É–∫–∞–∂–∏ —Å–≤–æ–π –ø–∞—Ä–æ–ª—å:

```bash
cp env.example .env
nano .env   # –∏–∑–º–µ–Ω–∏ PIHOLE_WEBPASSWORD=change-me
```

### 2) –ó–∞–ø—É—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–∫—É (–æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞)

```bash
sudo chmod +x ./scripts/*.sh
sudo ./scripts/install.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü–æ—Å—Ç–∞–≤–∏—Ç Docker, ipset, iptables
- –ó–∞–ø—É—Å—Ç–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (Pi-hole + v2rayA)
- –ù–∞—Å—Ç—Ä–æ–∏—Ç dnsmasq ‚Üí ipset ‚Üí iptables
- –í–∫–ª—é—á–∏—Ç –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –∏ TProxy

–í –∫–æ–Ω—Ü–µ –æ–Ω –ø–æ–∫–∞–∂–µ—Ç **–∞–¥—Ä–µ—Å–∞ –ø–∞–Ω–µ–ª–µ–π** –∏ **—á—Ç–æ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –≤ DHCP –Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ**.

### 3) –ù–∞—Å—Ç—Ä–æ–π v2rayA (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)

–û—Ç–∫—Ä–æ–π –≤–µ–±-–ø–∞–Ω–µ–ª—å v2rayA:

```
http://<IP_RASPBERRY_PI>:2017
```

- –î–æ–±–∞–≤—å —Å–≤–æ–π VPN-—Å–µ—Ä–≤–µ—Ä/–ø–æ–¥–ø–∏—Å–∫—É
- –ü–æ–¥–∫–ª—é—á–∏—Å—å (—Å—Ç–∞—Ç—É—Å –¥–æ–ª–∂–µ–Ω —Å—Ç–∞—Ç—å "Connected")
- –í–∫–ª—é—á–∏ **Transparent Proxy / TProxy**, –ø–æ—Ä—Ç **52345**

–ï—Å–ª–∏ –ø–æ–º–µ–Ω—è–ª –ø–æ—Ä—Ç –≤ v2rayA, –ø—Ä–∏–º–µ–Ω–∏ –µ–≥–æ —Ç–∞–∫:

```bash
sudo TPROXY_PORT=<YOUR_PORT> ./scripts/apply-tproxy.sh
```

### 4) –ù–∞—Å—Ç—Ä–æ–π DHCP –Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ (–∫–ª—é—á–µ–≤–æ–π —à–∞–≥!)

–ó–∞–π–¥–∏ –≤ –≤–µ–±-–ø–∞–Ω–µ–ª—å —Ä–æ—É—Ç–µ—Ä–∞ ‚Üí –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DHCP:

- **Default Gateway (Option 3)** = **IP Raspberry Pi**
- **DNS (Option 6)** = **IP Raspberry Pi** (DNS2 –æ—Å—Ç–∞–≤—å –ø—É—Å—Ç—ã–º –∏–ª–∏ —Ç–æ–∂–µ Pi)

**–°–æ—Ö—Ä–∞–Ω–∏ –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏ —Ä–æ—É—Ç–µ—Ä** (–∏–ª–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∫ Wi-Fi).

### 5) –ü—Ä–æ–≤–µ—Ä—å —Ä–∞–±–æ—Ç—É

–ù–∞ Raspberry Pi:

```bash
sudo ./scripts/quick-check.sh
```

–ï—Å–ª–∏ —Å—á—ë—Ç—á–∏–∫–∏ `iptables` –ø–æ `vpnlist` —Ä–∞—Å—Ç—É—Ç ‚Äî –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç! üéâ

–ù–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ (Windows):

```powershell
ipconfig /all
```

–£–±–µ–¥–∏—Å—å, —á—Ç–æ **Default Gateway** –∏ **DNS Servers** —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ IP Raspberry Pi.

---

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ü–æ–∫–∞–∑–∞—Ç—å –∞–¥—Ä–µ—Å–∞ –ø–∞–Ω–µ–ª–µ–π –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DHCP

```bash
sudo ./scripts/show-info.sh
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DNS ‚Üí ipset

```bash
sudo ./scripts/dns-ipset-test.sh youtube.com
```

### –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–º–µ–Ω—ã/–ø—Ä–∞–≤–∏–ª–∞ (–ø–æ—Å–ª–µ `git pull`)

```bash
git pull
sudo ./scripts/update.sh
```

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –¥–æ–º–µ–Ω –≤ VPN-—Å–ø–∏—Å–æ–∫

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π `configs/05-vpnlist.conf`:

```bash
nano configs/05-vpnlist.conf
```

–î–æ–±–∞–≤—å —Å—Ç—Ä–æ–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è TikTok):

```
ipset=/tiktok.com/vpnlist
ipset=/tiktokcdn.com/vpnlist
```

–ó–∞—Ç–µ–º:

```bash
sudo ./scripts/update.sh
```

---

## üÜò –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### iptables counters = 0 (—Ç—Ä–∞—Ñ–∏–∫ –Ω–µ –∏–¥—ë—Ç —á–µ—Ä–µ–∑ Pi)

**–ü—Ä–∏—á–∏–Ω–∞:** —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç Raspberry Pi –∫–∞–∫ —à–ª—é–∑.

**–†–µ—à–µ–Ω–∏–µ:** –ø—Ä–æ–≤–µ—Ä—å DHCP Option 3 –Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ, –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.

### YouTube web —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–∏—Å–∏—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–æ–º–µ–Ω—ã (API, CDN).

**–†–µ—à–µ–Ω–∏–µ:** –¥–æ–±–∞–≤—å –¥–æ–º–µ–Ω—ã –≤ `configs/05-vpnlist.conf` (—É–∂–µ –µ—Å—Ç—å –±–∞–∑–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ –¥–ª—è YouTube/Instagram/WhatsApp).

### Port 53 already in use (Pi-hole –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç)

**–ü—Ä–∏—á–∏–Ω–∞:** –Ω–∞ —Ö–æ—Å—Ç–µ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç DNS-—Å–ª—É–∂–±–∞ (—á–∞—Å—Ç–æ `systemd-resolved`).

**–†–µ—à–µ–Ω–∏–µ:**

```bash
sudo systemctl disable --now systemd-resolved
sudo docker compose up -d
```

### iOS Private Relay / Secure DNS –æ–±—Ö–æ–¥–∏—Ç Pi-hole

**–ü—Ä–∏—á–∏–Ω–∞:** iOS –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DoH/DoT, –º–∏–Ω—É—è –ª–æ–∫–∞–ª—å–Ω—ã–π DNS.

**–†–µ—à–µ–Ω–∏–µ:** –æ—Ç–∫–ª—é—á–∏ Private Relay –∏ "Limit IP Address Tracking" –Ω–∞ iPhone (Settings ‚Üí Wi-Fi ‚Üí —Ç–≤–æ—è —Å–µ—Ç—å ‚Üí i).

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [docs/LEGACY_RECOVERY.md](docs/LEGACY_RECOVERY.md) ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å)
- [docs/PUBLISH_TO_GITHUB.md](docs/PUBLISH_TO_GITHUB.md) ‚Äî –∫–∞–∫ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

---

## üõ°Ô∏è Security

- ‚úÖ –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ –∏ `.env` –∏—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ git (—Å–º. `.gitignore`)
- ‚úÖ –ù–µ –ø—É–±–ª–∏–∫—É–π SSH-–∫–ª—é—á–∏ –∏ –ø–∞—Ä–æ–ª–∏
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π —Å–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å –¥–ª—è Pi-hole –∏ v2rayA

---

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –∫–∞–∫ —Ö–æ—á–µ—à—å, –Ω–æ –±–µ–∑ –≥–∞—Ä–∞–Ω—Ç–∏–π.

---

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –ø–æ–º–æ–≥ ‚Äî –ø–æ—Å—Ç–∞–≤—å ‚≠ê –Ω–∞ GitHub!

–ù–∞—à—ë–ª –±–∞–≥ –∏–ª–∏ —Ö–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–º–µ–Ω? –û—Ç–∫—Ä–æ–π Issue –∏–ª–∏ Pull Request.
